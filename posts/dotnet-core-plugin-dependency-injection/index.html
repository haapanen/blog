<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Jussi Haapanen">
    <meta name="description" content="Jussi Haapanen&#39;s personal website">
    <meta name="keywords" content="blog,developer,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=".NET Core plugin dependency injection"/>
<meta name="twitter:description" content="Introduction You might run into a case where you would like to extend the application without updating the application core. Plugins could be one solution for the issue. It&rsquo;s fairly simple to implement a plugin architecture in .NET Core. Microsoft has documented the process of adding plugin support for your application in Creating an application with plugin support.
It&rsquo;s a good quick start to plugin architecture and gets you quite far."/>

    <meta property="og:title" content=".NET Core plugin dependency injection" />
<meta property="og:description" content="Introduction You might run into a case where you would like to extend the application without updating the application core. Plugins could be one solution for the issue. It&rsquo;s fairly simple to implement a plugin architecture in .NET Core. Microsoft has documented the process of adding plugin support for your application in Creating an application with plugin support.
It&rsquo;s a good quick start to plugin architecture and gets you quite far." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jussihaapanen.com/posts/dotnet-core-plugin-dependency-injection/" />
<meta property="article:published_time" content="2020-07-07T12:35:16&#43;03:00"/>
<meta property="article:modified_time" content="2020-07-07T12:35:16&#43;03:00"/>


    
      <base href="https://jussihaapanen.com/posts/dotnet-core-plugin-dependency-injection/">
    
    <title>
  .NET Core plugin dependency injection Â· JUSSI HAAPANEN
</title>

    
      <link rel="canonical" href="https://jussihaapanen.com/posts/dotnet-core-plugin-dependency-injection/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
    <script>
    window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#000"
        },
        "button": {
          "background": "#f1d600"
        }
      },
      "theme": "edgeless"
    })});
    </script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-41962308-4"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-41962308-4');
    </script>


    
      
      
      <link rel="stylesheet" href="https://jussihaapanen.com/css/coder.min.28d751104f30c16da1aa1bb04015cbe662cacfe0d1b01af4f2240ad58580069c.css" integrity="sha256-KNdREE8wwW2hqhuwQBXL5mLKz&#43;DRsBr08iQK1YWABpw=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="https://jussihaapanen.com/css/custom.css">
    

    <link rel="icon" type="image/png" href="https://jussihaapanen.com/img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://jussihaapanen.com/img/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.55.6" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://jussihaapanen.com">
      JUSSI HAAPANEN
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://jussihaapanen.com/posts/">Blog</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">.NET Core plugin dependency injection</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2020-07-07T12:35:16&#43;03:00'>
                July 7, 2020
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              7 minutes read
            </span>
          </div>
          
          
        </div>
      </header>

      <div>
        

<h1 id="introduction">Introduction</h1>

<p>You might run into a case where you would like to extend the application without updating the application core. Plugins could be one solution for the issue. It&rsquo;s fairly simple to implement a plugin architecture in .NET Core. Microsoft has documented the process of adding plugin support for your application in <a href="https://docs.microsoft.com/en-us/dotnet/core/tutorials/creating-app-with-plugin-support">Creating an application with plugin support</a>.</p>

<p>It&rsquo;s a good quick start to plugin architecture and gets you quite far. However, it does not explain how to add support for dependency injection from host process to the plugin process. Plugins own internal dependencies could be created on plugin initialization and injected to the executing code but I prefer to have the .NET Core dependency injection system handle these dependencies as well. Plugin configuration is a good example of an object I&rsquo;d prefer to be initialized and injected by the .NET Core DI.</p>

<h1 id="example-case">Example case</h1>

<p>Imagine we&rsquo;re developing a software where we receive messages from an external system and would like to deliver those to various other systems. We could implement the event handler as an Azure Function Appyo and add various integrations to other systems.</p>

<p><img src="https://jussihaapanen.com/images/dotnet-core-plugin-dependency-injection/overview.png" alt="Overview of the imaginary system" /></p>

<p>Overview of the imaginary system</p>

<p>In the example code I&rsquo;ve implemented the event handler as a .NET Core background service. The full example code is available at <a href="https://github.com/haapanen/NetCorePluginDI">GitHub</a></p>

<p>We&rsquo;ll use the .NET Core documentation plugin application example as the starting point for the system. In the example the project structure is following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">AppWithPlugin
PluginBase
HelloPlugin</pre></div>
<p>In our case we&rsquo;ll be implementing something similar with slightly different names:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">AppWithPlugin --&gt; NetCorePluginDI
PluginBase --&gt; NetCorePluginDI.PluginBase
HelloPlugin --&gt; NetCorePluginDI.Integrations.*</pre></div>
<p>Most of the code will stay the same.</p>

<p>As the plugins will be integrations, I&rsquo;ve named the IPlugin interface from the original example to IIntegration. The rest of the interface stays mostly the same:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> IIntegration
{
    <span style="color:#66d9ef">string</span> Name { <span style="color:#66d9ef">get</span>; }
    <span style="color:#66d9ef">string</span> Description { <span style="color:#66d9ef">get</span>; }
    Task ExecuteAsync(<span style="color:#66d9ef">string</span> message, CancellationToken cancellationToken);
}
</code></pre></div>
<p>This interface will be implemented by all of the plugins (Blob storage, HTTP and DB plugin). Below is a simplified version of the blob storage plugin.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BlobStorageArchiveIntegration</span> : IIntegration
{
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> ILogger&lt;BlobStorageArchiveIntegration&gt; _logger;

    <span style="color:#66d9ef">public</span> BlobStorageArchiveIntegration(ILogger&lt;BlobStorageArchiveIntegration&gt; logger)
    {
        _logger = logger;
    }

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Name { <span style="color:#66d9ef">get</span>; } = <span style="color:#e6db74">&#34;Blob Storage Archive&#34;</span>;
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Description { <span style="color:#66d9ef">get</span>; } = <span style="color:#e6db74">&#34;An integration to archive messages to Blob Storage&#34;</span>;
    <span style="color:#66d9ef">public</span> Task ExecuteAsync(<span style="color:#66d9ef">string</span> message, CancellationToken cancellationToken)
    {
        <span style="color:#75715e">// Let&#39;s pretend we&#39;re archiving to Blob Storage
</span><span style="color:#75715e"></span>        _logger.LogInformation(<span style="color:#e6db74">$&#34;Archiving message [{message}] to Blob Storage&#34;</span>);

        <span style="color:#66d9ef">return</span> Task.CompletedTask;
    }
}
</code></pre></div>
<p>It will receive a message and &ldquo;store&rdquo; it to the blob storage (for demonstration purposes we&rsquo;ll just log the message).</p>

<h1 id="the-problem">The problem</h1>

<p>The above example with the original plugin example will work but there&rsquo;s one major issue: All of the plugins need some sort of configuration. Blob storage and DB integrations need a connection string, HTTP integration needs an URL to send the message to.</p>

<p>You could approach this by initializing the settings in the plugin by reading the settings from a file, injecting and using the IConfiguration interface or through some other method. However it would require you to define the settings initialization logic for each integration separately.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BlobStorageArchiveIntegration</span> : IIntegration
{
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> ILogger&lt;BlobStorageArchiveIntegration&gt; _logger;

    <span style="color:#66d9ef">public</span> BlobStorageArchiveIntegration(ILogger&lt;BlobStorageArchiveIntegration&gt; logger)
    {
        _logger = logger;
    }

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Name { <span style="color:#66d9ef">get</span>; } = <span style="color:#e6db74">&#34;Blob Storage Archive&#34;</span>;
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Description { <span style="color:#66d9ef">get</span>; } = <span style="color:#e6db74">&#34;An integration to archive messages to Blob Storage&#34;</span>;

		<span style="color:#66d9ef">public</span> Task InitializeAsync()
		{
				<span style="color:#75715e">// Read settings from somewhere and store them locally
</span><span style="color:#75715e"></span>				<span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>		}

    <span style="color:#66d9ef">public</span> Task ExecuteAsync(<span style="color:#66d9ef">string</span> message, CancellationToken cancellationToken)
    {
        <span style="color:#75715e">// Let&#39;s pretend we&#39;re archiving to Blob Storage
</span><span style="color:#75715e"></span>        _logger.LogInformation(<span style="color:#e6db74">$&#34;Archiving message [{message}] to Blob Storage&#34;</span>);

        <span style="color:#66d9ef">return</span> Task.CompletedTask;
    }
}
</code></pre></div>
<p>I&rsquo;d prefer not having to specify initialization logic on each integration. Additionally this is pretty much a solved problem by the .NET Core DI, we could just use it instead.</p>

<h1 id="the-solution">The solution</h1>

<p>Let&rsquo;s define a class that we&rsquo;ll inject to the integration.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HttpIntegrationSettings</span>
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Url { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
}
</code></pre></div>
<p>Let&rsquo;s use the settings in the integration.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HttpIntegration</span> : IIntegration
{
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> ILogger&lt;HttpIntegration&gt; _logger;
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> HttpIntegrationSettings _settings;

    <span style="color:#66d9ef">public</span> HttpIntegration(ILogger&lt;HttpIntegration&gt; logger, HttpIntegrationSettings settings)
    {
        _logger = logger;
        _settings = settings;
    }

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Name { <span style="color:#66d9ef">get</span>; } = <span style="color:#e6db74">&#34;HTTP&#34;</span>;
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Description { <span style="color:#66d9ef">get</span>; } = <span style="color:#e6db74">&#34;An integration to send messages to a REST endpoint&#34;</span>;
    <span style="color:#66d9ef">public</span> Task ExecuteAsync(<span style="color:#66d9ef">string</span> message, CancellationToken cancellationToken)
    {
        <span style="color:#75715e">// Let&#39;s pretend we&#39;re sending messages to another service
</span><span style="color:#75715e"></span>        _logger.LogInformation(<span style="color:#e6db74">$&#34;Sending message [{message}] to [{_settings.Url}]&#34;</span>);

        <span style="color:#66d9ef">return</span> Task.CompletedTask;
    }
}
</code></pre></div>
<p>Now the question is, how will we inform the DI framework about the HttpIntegrationSettings class and that it should load the settings from the IConfiguration providers?</p>

<p>We can achieve that by changing the module loading code. Let&rsquo;s start by defining an interface that all injected settings classes will be implementing.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> ISettings
{
}
</code></pre></div>
<p>Let&rsquo;s just define an empty interface. It&rsquo;s just to declare the type is injectable as an interface. We could also use a naming convention such as if type name ends in Settings, we&rsquo;ll inject it as settings. I prefer to be explicit.</p>

<p>Once we&rsquo;ve added the ISetting interface and implemented it in HttpIntegrationSettings, we can implement the additional plugin code to instantiate and inject settings instances to the service provider.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> RegisterIntegrationsFromAssembly(IServiceCollection services, IConfiguration configuration, Assembly assembly)
{
    <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> type <span style="color:#66d9ef">in</span> assembly.GetTypes())
    {
        <span style="color:#75715e">// Register all classes that implement the IIntegration interface
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span>(IIntegration).IsAssignableFrom(type))
        {
            <span style="color:#75715e">// Add as a singleton as the Worker is a singleton and we&#39;ll only have one
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// instance. If this would be a Controller or something else with clearly defined
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// scope that is not the lifetime of the application, use AddScoped.
</span><span style="color:#75715e"></span>            services.AddSingleton(<span style="color:#66d9ef">typeof</span>(IIntegration), type);
        }

        <span style="color:#75715e">// Register all classes that implement the ISettings interface
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span>(ISettings).IsAssignableFrom(type))
        {
            <span style="color:#66d9ef">var</span> settings = Activator.CreateInstance(type);
            <span style="color:#75715e">// appsettings.json or some other configuration provider should contain
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// a key with the same name as the type
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// e.g. &#34;HttpIntegrationSettings&#34;: { ... }
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (!configuration.GetSection(type.Name).Exists())
            {
                <span style="color:#75715e">// If it does not contain the key, throw an error
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> ArgumentException(<span style="color:#e6db74">$&#34;Configuration does not contain key [{type.Name}]&#34;</span>);
            }
            configuration.Bind(type.Name, settings);

            <span style="color:#75715e">// Settings can be singleton as we&#39;ll only ever read it
</span><span style="color:#75715e"></span>            services.AddSingleton(type, settings);
        }
    }
}
</code></pre></div>
<p>We&rsquo;ll register the integration as previously. For all interfaces implementing the ISettings interface we&rsquo;ll create the instance for the type. Then we&rsquo;ll ensure that the type name exists as a key in the settings (e.g. appsettings.json, environment variables or in another configuration provider). If the key exists, let&rsquo;s bind the object to the instance and register the settings to the service provider.</p>

<p>This way we&rsquo;ll able utilize the existing infrastructure to load settings for the plugins.</p>

<p>Let&rsquo;s run the application:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-jsx" data-lang="jsx"><span style="color:#a6e22e">Loading</span> <span style="color:#a6e22e">integrations</span> <span style="color:#a6e22e">from</span><span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">Path</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">To</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">NetCorePluginDI</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">NetCorePluginDI</span>.<span style="color:#a6e22e">Integrations</span>.<span style="color:#a6e22e">BlobStorageArchive</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">bin</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">Debug</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">netstandard2</span><span style="color:#ae81ff">.0</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">NetCorePluginDI</span>.<span style="color:#a6e22e">Integrations</span>.<span style="color:#a6e22e">BlobStorageArchive</span>.<span style="color:#a6e22e">dll</span>
<span style="color:#a6e22e">Loading</span> <span style="color:#a6e22e">integrations</span> <span style="color:#a6e22e">from</span><span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">Path</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">TNetCorePluginDI</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">NetCorePluginDI</span>.<span style="color:#a6e22e">Integrations</span>.<span style="color:#a6e22e">Http</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">bin</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">Debug</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">netstandard2</span><span style="color:#ae81ff">.0</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">NetCorePluginDI</span>.<span style="color:#a6e22e">Integrations</span>.<span style="color:#a6e22e">Http</span>.<span style="color:#a6e22e">dll</span>
<span style="color:#a6e22e">info</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">NetCorePluginDI</span>.<span style="color:#a6e22e">Integrations</span>.<span style="color:#a6e22e">BlobStorageArchive</span>.<span style="color:#a6e22e">BlobStorageArchiveIntegration</span>[<span style="color:#ae81ff">0</span>]
      <span style="color:#a6e22e">Archiving</span> <span style="color:#a6e22e">message</span> [<span style="color:#a6e22e">Worker</span> <span style="color:#a6e22e">running</span> <span style="color:#a6e22e">at</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">6.7.2020</span> <span style="color:#ae81ff">21.51.14</span> <span style="color:#f92672">+</span><span style="color:#ae81ff">03</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>] <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">Blob</span> <span style="color:#a6e22e">Storage</span>
<span style="color:#a6e22e">info</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">NetCorePluginDI</span>.<span style="color:#a6e22e">Integrations</span>.<span style="color:#a6e22e">Http</span>.<span style="color:#a6e22e">HttpIntegration</span>[<span style="color:#ae81ff">0</span>]
      <span style="color:#a6e22e">Sending</span> <span style="color:#a6e22e">message</span> [<span style="color:#a6e22e">Worker</span> <span style="color:#a6e22e">running</span> <span style="color:#a6e22e">at</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">6.7.2020</span> <span style="color:#ae81ff">21.51.14</span> <span style="color:#f92672">+</span><span style="color:#ae81ff">03</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>] <span style="color:#a6e22e">to</span> [<span style="color:#a6e22e">https</span><span style="color:#f92672">:</span><span style="color:#75715e">//localhost:3000/api/message]
</span><span style="color:#75715e"></span><span style="color:#a6e22e">info</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Microsoft</span>.<span style="color:#a6e22e">Hosting</span>.<span style="color:#a6e22e">Lifetime</span>[<span style="color:#ae81ff">0</span>]
      <span style="color:#a6e22e">Application</span> <span style="color:#a6e22e">started</span>. <span style="color:#a6e22e">Press</span> <span style="color:#a6e22e">Ctrl</span><span style="color:#f92672">+</span><span style="color:#a6e22e">C</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">shut</span> <span style="color:#a6e22e">down</span>.
<span style="color:#a6e22e">info</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Microsoft</span>.<span style="color:#a6e22e">Hosting</span>.<span style="color:#a6e22e">Lifetime</span>[<span style="color:#ae81ff">0</span>]
      <span style="color:#a6e22e">Hosting</span> <span style="color:#a6e22e">environment</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Development</span>
<span style="color:#a6e22e">info</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Microsoft</span>.<span style="color:#a6e22e">Hosting</span>.<span style="color:#a6e22e">Lifetime</span>[<span style="color:#ae81ff">0</span>]
      <span style="color:#a6e22e">Content</span> <span style="color:#a6e22e">root</span> <span style="color:#a6e22e">path</span><span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">Path</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">To</span><span style="color:#960050;background-color:#1e0010">\\</span><span style="color:#a6e22e">NetCorePluginDI</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">NetCorePluginDI</span>
<span style="color:#a6e22e">info</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">NetCorePluginDI</span>.<span style="color:#a6e22e">Integrations</span>.<span style="color:#a6e22e">BlobStorageArchive</span>.<span style="color:#a6e22e">BlobStorageArchiveIntegration</span>[<span style="color:#ae81ff">0</span>]
      <span style="color:#a6e22e">Archiving</span> <span style="color:#a6e22e">message</span> [<span style="color:#a6e22e">Worker</span> <span style="color:#a6e22e">running</span> <span style="color:#a6e22e">at</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">6.7.2020</span> <span style="color:#ae81ff">21.51.15</span> <span style="color:#f92672">+</span><span style="color:#ae81ff">03</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>] <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">Blob</span> <span style="color:#a6e22e">Storage</span>
<span style="color:#a6e22e">info</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">NetCorePluginDI</span>.<span style="color:#a6e22e">Integrations</span>.<span style="color:#a6e22e">Http</span>.<span style="color:#a6e22e">HttpIntegration</span>[<span style="color:#ae81ff">0</span>]
      <span style="color:#a6e22e">Sending</span> <span style="color:#a6e22e">message</span> [<span style="color:#a6e22e">Worker</span> <span style="color:#a6e22e">running</span> <span style="color:#a6e22e">at</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">6.7.2020</span> <span style="color:#ae81ff">21.51.15</span> <span style="color:#f92672">+</span><span style="color:#ae81ff">03</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>] <span style="color:#a6e22e">to</span> [<span style="color:#a6e22e">https</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">//localhost:3000/api/message]</span></code></pre></div>
<p>As you can see, we&rsquo;ll load integrations from two DLLs, the Blob Storage and HTTP integration DLLs. The system receives a message every second and sends it to the integrations. In the log output you can see HttpIntegration logging the endpoint url that was defined in the project appsettings.json (<a href="https://localhost:3000/api/message">https://localhost:3000/api/message</a>).</p>

<p>This can be extended even further. If we have a type we&rsquo;d like to inject to the plugin we can implement another interface. I&rsquo;ll call it IInjectedDependency. It&rsquo;s an empty interface. All types that implement this interface will be registered to the service provider.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> IInjectedDependency
{
}

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Service</span> : IInjectedDependency
{
		<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> DoWork()
		{
				<span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>		}
}
</code></pre></div>
<p>This way we can fully utilize the .NET Core DI framework within the plugins.</p>

      </div>

      <footer>
        


        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "haapanen" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
    
    
      
      Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
